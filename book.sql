CREATE DATABASE IF NOT EXISTS bibliotheque;
USE bibliotheque;

-- CRÉATION DES TABLES
CREATE TABLE LIVRE (
    ID INT NOT NULL AUTO_INCREMENT PRIMARY KEY, 
    TITRE VARCHAR(255) NOT NULL, 
    AUTEUR VARCHAR(50) NOT NULL
);

CREATE TABLE CLIENT (
    ID INT NOT NULL AUTO_INCREMENT PRIMARY KEY,
    NOM VARCHAR(50) NOT NULL,
    PRENOM VARCHAR(50) NOT NULL
);

CREATE TABLE EMPRUNT (
    ID int NOT NULL AUTO_INCREMENT PRIMARY KEY, 
    DATE_DEBUT TIMESTAMP NOT NULL,
    DATE_FIN TIMESTAMP NULL,
    DELAI INT NOT NULL,
    ID_CLIENT INT,
    CONSTRAINT FK_CLIENT_ID FOREIGN KEY (ID_CLIENT) REFERENCES CLIENT(ID)
);

CREATE TABLE COMPO (
    ID INT NOT NULL AUTO_INCREMENT PRIMARY KEY,
    ID_LIVRE INT NOT NULL,
    ID_EMPRUNT INT NOT NULL,
    CONSTRAINT FK_LIVRE_ID FOREIGN KEY (ID_LIVRE) REFERENCES LIVRE(ID),
    CONSTRAINT FK_EMPRUNT_ID FOREIGN KEY (ID_EMPRUNT) REFERENCES EMPRUNT(ID)
);

-- INSERTIONS
insert into CLIENT (NOM, PRENOM) VALUES ('Brigand', 'Pierre');
insert into CLIENT (NOM, PRENOM) VALUES ('YU', 'Cheng');
insert into CLIENT (NOM, PRENOM) VALUES ('BERRAD', 'Hicham');
insert into LIVRE (ID, TITRE, AUTEUR) VALUES (1, 'Vingt mille lieues sous les mers', 'Jules Verne');
insert into LIVRE (ID, TITRE, AUTEUR) VALUES (2, 'Germinal', 'Emile Zola');
insert into LIVRE (ID, TITRE, AUTEUR) VALUES (3, 'Guerre et paix', 'Léon Tolstoï');
insert into LIVRE (ID, TITRE, AUTEUR) VALUES (4, 'Apprendre à parler aux animaux', 'Gaston Pouet');
insert into LIVRE (ID, TITRE, AUTEUR) VALUES (5, '1001 recettes de Cuisine', 'Jean-Pierre Coffe');
insert into EMPRUNT (ID, DATE_DEBUT, DATE_FIN, DELAI, ID_CLIENT) VALUES (1, '2017-11-12', '2017-11-18', 15, 1);
insert into EMPRUNT (ID, DATE_DEBUT, DATE_FIN, DELAI, ID_CLIENT) VALUES (2, '2017-12-08', '2017-12-23', 30, 2);
insert into EMPRUNT (ID, DATE_DEBUT, DATE_FIN, DELAI, ID_CLIENT) VALUES (3, '2017-12-09', '2018-01-04', 30, 3);
insert into EMPRUNT (ID, DATE_DEBUT, DATE_FIN, DELAI, ID_CLIENT) VALUES (4, '2018-01-03', NULL, 21, 1);
insert into EMPRUNT (ID, DATE_DEBUT, DATE_FIN, DELAI, ID_CLIENT) VALUES (5, '2018-01-13', NULL, 21, 3);
insert into COMPO (ID_LIVRE, ID_EMPRUNT) VALUES (1, 1);
insert into COMPO (ID_LIVRE, ID_EMPRUNT) VALUES (4, 1);
insert into COMPO (ID_LIVRE, ID_EMPRUNT) VALUES (2, 2);
insert into COMPO (ID_LIVRE, ID_EMPRUNT) VALUES (3, 2);
insert into COMPO (ID_LIVRE, ID_EMPRUNT) VALUES (1, 3);
insert into COMPO (ID_LIVRE, ID_EMPRUNT) VALUES (5, 4);
insert into COMPO (ID_LIVRE, ID_EMPRUNT) VALUES (2, 4);
insert into COMPO (ID_LIVRE, ID_EMPRUNT) VALUES (3, 5);